# Ceph 混合存储池（Optane + HDD）性能验证分析报告

**日期**: 2025-12-05
**测试对象**: numa-900p-hdd (Intel Optane 900P + Mechanical HDD)
**测试场景**: 4K 随机读写 (RND-RW-4K-70-30)

---

## 1. 核心结论

**测试结果合理，但属于“最佳路径（Cache Hit）”性能。**

当前测得的 **25,000+ Read IOPS** 和 **10,000+ Write IOPS** 远超机械硬盘（HDD）物理极限。这并非测试误差，而是成功验证了 Ceph 混合架构中 **RAM 缓存** 和 **Optane WAL/DB** 的加速效果。数据流实际上是在与内存和 NVMe 交互，而非直接受限于机械臂物理寻道。

---

## 2. 性能数据对比：物理值 vs 实测值

| 指标 | 单块 HDD 物理极限 (理论值) | 混合架构实测值 (900P + Cache) | 提升倍数 | 数据来源组件 |
| :--- | :--- | :--- | :--- | :--- |
| **随机读取 (IOPS)** | 80 - 150 | **25,114** | ~200倍 | **Server RAM (OSD Cache)** |
| **随机写入 (IOPS)** | 80 - 150 | **10,764** | ~90倍 | **Intel Optane 900P (WAL)** |
| **读写延迟 (ms)** | 10ms - 20ms | **1ms - 2ms** | ~10倍优化 | **RAM / Optane** |

---

## 3. 原理深度分析

### 3.1 读取性能 (25k IOPS) - 源自 RAM
*   **现象**：HDD 的物理寻道时间约为 8-10ms，决定了其单盘物理 IOPS 锁死在 100 左右。测试跑出 25k IOPS 说明读请求根本没有到达磁盘盘片。
*   **原因**：Ceph 的 **BlueStore Cache** 和操作系统的 **Page Cache** 发挥了作用。
*   **机制**：测试数据集（50GB）相对较小，或者热点数据已被完全加载到服务器内存中。客户端读取数据时，直接从内存返回，因此获得了纳秒/微秒级的响应速度。

### 3.2 写入性能 (10k IOPS) - 源自 Optane
*   **现象**：HDD 无法承受 10k 的随机写入。
*   **原因**：利用了 Optane 极强的随机写能力作为缓冲（WAL - Write Ahead Log）。
*   **机制**：
    1.  **写入路径**：Client -> OSD -> **Optane (WAL/DB)** -> 返回成功 (Ack)。
    2.  **异步落盘**：数据后续会由 OSD 进程慢慢从 Optane 整理并顺序写入到 HDD（Destage）。
    3.  **带宽掩盖**：本次测试的写入带宽约为 **40-45 MB/s**。而现代 7200转 HDD 的*顺序*写入带宽约为 150-200 MB/s。
    4.  **结论**：因为`写入带宽 < HDD后台刷盘带宽`，Optane 的缓冲区始终不会溢出，因此前端表现出的性能完全等同于 Optane 的性能，完美屏蔽了 HDD 的短板。

---

## 4. 生产环境风险提示

虽然测试数据亮眼，但在生产环境中需注意以下“性能悬崖”场景：

### 4.1 缓存穿透 (Cache Miss)
*   **场景**：当业务数据总量巨大（例如 50TB），且访问完全随机，无法被内存（例如 128GB）完全缓存时。
*   **后果**：读请求必须穿透到 HDD 物理盘片。
*   **预期性能**：IOPS 将从 **25,000** 骤降至 **80 - 150 (HDD 物理极限)**，延迟增加到 10ms+。

### 4.2 写入缓冲区溢出 (Buffer Saturation)
*   **场景**：如果业务写入带宽持续超过 HDD 的物理顺序写入上限（例如持续以 >200MB/s 写入数小时）。
*   **后果**：Optane WAL 写满，OSD 被迫停止接收新请求，等待 HDD 完成后台刷盘。
*   **预期性能**：写性能将由 Optane 速度跌落至 HDD 的顺序写入速度，且伴随巨大的延迟抖动。

## 5. 总结

该测试结果证明了 **“Optane + HDD” 混合存储池配置正确**。系统成功利用了高速介质（RAM 和 Optane）来处理元数据和日志，极大地提升了特定场景下（热数据 + 突发写入）的性能表现。

*   **测试有效性**：有效。
*   **架构评价**：优秀，性价比高。用少量 Optane 换取了接近全闪存的突发性能体验。
