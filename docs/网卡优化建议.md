## Ceph存储网络网卡优化建议

### 检查总结
已在dc1-stor40、dc1-stor41、dc1-stor42三个节点完成检查。三个节点的配置完全一致。

### 当前配置分析

**良好配置：**
- Pause流控已启用（RX/TX: on）
- GRO/GSO已启用，LRO已禁用
- Checksum已启用
- 队列数63个combined（合理）
- 缓冲区RX/TX均为8192（良好）
- MTU已配置为9000（启用了大帧）

**需要优化：**
- Coalesce参数过于保守（rx-usecs: 8, rx-frames: 128），可能导致高I/O场景下的延迟增加

### 优化建议

#### 方案一：激进性能优化（推荐用于高性能Ceph集群）
降低中断延迟，适合IOPS密集型工作负载：
```bash
# 适用于dc1-stor40、dc1-stor41、dc1-stor42
ssh ubuntu@dc1-stor40 'ethtool -C vth0 rx-usecs 1 rx-frames 64 tx-usecs 1 tx-frames 64'
ssh ubuntu@dc1-stor40 'ethtool -C vth1 rx-usecs 1 rx-frames 64 tx-usecs 1 tx-frames 64'

ssh ubuntu@dc1-stor41 'ethtool -C vth0 rx-usecs 1 rx-frames 64 tx-usecs 1 tx-frames 64'
ssh ubuntu@dc1-stor41 'ethtool -C vth1 rx-usecs 1 rx-frames 64 tx-usecs 1 tx-frames 64'

ssh ubuntu@dc1-stor42 'ethtool -C vth0 rx-usecs 1 rx-frames 64 tx-usecs 1 tx-frames 64'
ssh ubuntu@dc1-stor42 'ethtool -C vth1 rx-usecs 1 rx-frames 64 tx-usecs 1 tx-frames 64'
```

#### 方案二：平衡优化
在延迟和CPU使用率之间取得平衡：
```bash
# 适用于dc1-stor40、dc1-stor41、dc1-stor42
ssh ubuntu@dc1-stor40 'ethtool -C vth0 rx-usecs 3 rx-frames 96 tx-usecs 3 tx-frames 96'
ssh ubuntu@dc1-stor40 'ethtool -C vth1 rx-usecs 3 rx-frames 96 tx-usecs 3 tx-frames 96'

ssh ubuntu@dc1-stor41 'ethtool -C vth0 rx-usecs 3 rx-frames 96 tx-usecs 3 tx-frames 96'
ssh ubuntu@dc1-stor41 'ethtool -C vth1 rx-usecs 3 rx-frames 96 tx-usecs 3 tx-frames 96'

ssh ubuntu@dc1-stor42 'ethtool -C vth0 rx-usecs 3 rx-frames 96 tx-usecs 3 tx-frames 96'
ssh ubuntu@dc1-stor42 'ethtool -C vth1 rx-usecs 3 rx-frames 96 tx-usecs 3 tx-frames 96'
```

### 注意事项
1. 优化后需要监控CPU使用率变化，Coalesce参数调整会影响CPU负载
2. 建议在生产环境实施前，先在一个节点上测试并观察效果
3. 若网络出现性能问题，可恢复默认配置：`ethtool -C vth0 rx-usecs 8 rx-frames 128 tx-usecs 8 tx-frames 128`
4. 建议将优化命令加入启动脚本（如/etc/rc.local或使用systemd）以确保重启后配置持久化
